/*!
 * @sie/designkit
 * @copyright     2023 Sony Interactive Entertainment LLC, all rights reserved
 */

!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function i(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}var a={IS_PORTRAIT:(window.matchMedia&&matchMedia("(orientation: portrait)")||{}).matches,IS_LANDSCAPE:(window.matchMedia&&matchMedia("(orientation: landscape)")||{}).matches,IS_MOBILE:(window.matchMedia&&matchMedia("(max-width: 767px)")||{}).matches,IS_MOBILE_PORTRAIT:(window.matchMedia("(max-width: 767px) and (orientation: portrait)")||{}).matches,IS_TABLET:(window.matchMedia&&matchMedia("(min-width: 768px)")||{}).matches,IS_DESKTOP:(window.matchMedia&&matchMedia("(min-width: 1024px)")||{}).matches},n={IS_PORTRAIT:window.matchMedia&&matchMedia("(orientation: portrait)")||{},IS_LANDSCAPE:window.matchMedia&&matchMedia("(orientation: landscape)")||{},IS_JETSTREAM_MOBILE:window.matchMedia&&matchMedia("(max-width: 699px)")||{},IS_MOBILE:window.matchMedia&&matchMedia("(max-width: 767px)")||{},IS_MOBILE_PORTRAIT:window.matchMedia("(max-width: 767px) and (orientation: portrait)")||{},IS_TABLET:window.matchMedia&&matchMedia("(min-width: 768px)")||{},IS_TABLET_LG:window.matchMedia&&matchMedia("(min-width: 1024px)")||{},IS_LAPTOP:window.matchMedia&&matchMedia("(min-width: 1367px)")||{},IS_DESKTOP:window.matchMedia&&matchMedia("(min-width: 1920px)")||{},IS_MAX_TABLET:window.matchMedia&&matchMedia("(max-width: 1023px)")||{},IS_JUST_TABLET:window.matchMedia&&matchMedia("(min-width: 768px) and (max-width: 1365px)")||{},IS_JUST_LAPTOP:window.matchMedia&&matchMedia("(min-width: 1366px) and (max-width: 1919px)")||{}},c=({IS_PORTRAIT:n.IS_PORTRAIT.matches,IS_LANDSCAPE:n.IS_LANDSCAPE.matches,IS_JETSTREAM_MOBILE:n.IS_JETSTREAM_MOBILE.matches,IS_MOBILE:n.IS_MOBILE.matches,IS_MOBILE_PORTRAIT:n.IS_MOBILE_PORTRAIT.matches,IS_TABLET:n.IS_TABLET.matches,IS_MAX_TABLET:n.IS_MAX_TABLET.matches,IS_TABLET_LG:n.IS_TABLET_LG.matches,IS_LAPTOP:n.IS_LAPTOP.matches,IS_DESKTOP:n.IS_DESKTOP.matches},{EMPTY_LABEL:"empty"}),o=function(){function t(){e(this,t),this.isRendering={mobile:!1,desktop:!1,count:0}}return i(t,[{key:"init",value:function(){var e=this,t=$('[data-component="game-grid"]'),i=function(i){e.isRendering={mobile:i,desktop:!i,count:1},i&&(e.isRendering.count=t.length),$.each(t,function(t,a){var n=$(a);n&&n.length?(e.createCarousels(n,!1,i),e.setTheme(n)):e.isRendering.count--})},c=function(t){e.isRendering.count<=0&&(e.isRendering={mobile:!1,desktop:!1,count:0}),e.isRendering.mobile||e.isRendering.desktop||i(t)};i(a.IS_MOBILE),n.IS_TABLET.onchange=function(e){e.matches&&c(!1)},n.IS_MOBILE.onchange=function(e){e.matches&&c(!0)},_gpdc.Logger.logInitializer("game-grid","components","Game Grid")}},{key:"setTheme",value:function(e){e.data("include-banner")?e.css("background",e.find('[data-component="page-banner"]').data("banner-theme")):e.data("game-grid-theme")&&e.css("background",e.data("game-grid-theme"))}},{key:"createMobileCarousels",value:function(e,t,i){var a=this,n=e.find(".game-grid__collections");n.off("ready.flickity");var c=e.find(".game-grid__games");$.each(c,function(e,n){var c=$(n),o=c.children();$.each(o,function(e,t){var i=$(t);i.removeClass("carousel-cell"),e%4==0&&$('<div class="game-grid__cell carousel-cell"></div>').appendTo(c);var a=e<=3?0:e>=8?2:1;i.appendTo(c.find(".game-grid__cell").get(a))}),c.children().remove(".game-grid__game"),c.one("ready.flickity",function(){return a.isRendering.count--}),t.createCarousel(c,i,".game-grid__collection",".game-grid__pagination").catch(function(){}),c.attr("aria-live","polite")})}},{key:"createDesktopCarousels",value:function(e,t,i){var a=this,n=e.find(".game-grid__collections");n.find(".game-grid__game").removeClass("carousel-cell");var o=e.find('.game-grid__collection[data-collection-subtitle="true"]'),d=e.find('.game-grid__collection[data-collection-btn="true"]');(o.length||d.length)&&this.setDynamicHeader(n),i.adapativeHeight=!1,i.draggable=!1,i.cellAlign="left",n.one("ready.flickity",function(){return a.isRendering.count--}),t.createCarousel(n,i).catch(function(){}),e.find(".carousel-cell.is-selected").attr("tabindex",0);var r=function(e){e=e.toLowerCase();var t="click.dkGameGridNextCollectionBtnClick";"previous"===e&&(t="click.dkGameGridPrevCollectionBtnClick"),n.siblings(".button--".concat(e)).on(t,function(t){_gpdc.analytics.event.addGDLEvent("click","select games grid ".concat(e),{moduleName:"games grid",elementType:"button",assetName:c.EMPTY_LABEL,label:c.EMPTY_LABEL,userActionFlag:!0},$(t.currentTarget)),n.flickity(e)})};r("previous"),r("next"),n.attr("aria-live","polite")}},{key:"createCarousels",value:function(e,t,i){var n=new _gpdc.components.Carousel,c={accessibility:!0,cellAlign:"center",wrapAround:!0,initialIndex:0,fullscreen:!0,imagesLoaded:!0,percentPosition:!0,prevNextButtons:!1,pageDots:!1};if(t)return void(a.IS_MOBILE?this.createMobileCarousels(e,n,c):e.data("multiple-collections")&&this.createDesktopCarousels(e,n,c));if(i){var o=e.find(".game-grid__collections"),d=e.find(".game-grid__games");return $.each(d,function(e,t){return $(t).removeAttr("aria-live")}),n.destroyCarousel(o),o.removeAttr("aria-live"),o.find(".game-grid__game").addClass("carousel-cell"),o.siblings(".button--previous").off("click.dkGameGridPrevCollectionBtnClick"),o.siblings(".button--next").off("click.dkGameGridNextCollectionBtnClick"),void this.createMobileCarousels(e,n,c)}var r=e.find(".game-grid__games");$.each(r,function(e,t){var i=$(t),a=i.find(".game-grid__game");$.each(i,function(e,t){return $(t).removeAttr("aria-live")}),n.destroyCarousel(i),$.each(a,function(e,t){return $(t).appendTo(i)}),i.children(".game-grid__cell").remove()}),e.data("multiple-collections")?this.createDesktopCarousels(e,n,c):this.isRendering.count--}},{key:"setDynamicHeader",value:function(e){var t=e.closest('[data-component="game-grid"]'),i=e.find(".game-grid__collection-header"),a=Math.max.apply(null,i.map(function(){return $(this).outerHeight()}).get()),n=a-t.find(".button--previous").height()/2;$.each(i,function(e,t){$(t).css("min-height",a)}),t.find(".button--previous").addClass("button--balance").css("top",n),t.find(".button--next").addClass("button--balance").css("top",n)}}]),t}(),d=function(){function t(){var i=this;e(this,t),window._gpdc&&_gpdc.user&&"undefined"!=typeof _gpdc.user.isLoggedIn?this.initModules():_gpdc.elements.$document.one("userInfoSet.dkComponents",function(){return i.initModules()})}return i(t,[{key:"initModules",value:function(){(new o).init()}}]),t}();!function(e){_gpdc.elements.$document.ready(function(){new d})}(jQuery)}();
